<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>üéÆ Rat Games</title>
    <link rel="icon" href="https://cty3ctyc42yjmxt3499ctn924u9xaje5y.vercel.app/media/favicon.png" type="image/png" />
    <link rel="manifest" href="/install/manifest.json" />
    <meta name="description" content="Play unblocked games like Subway Surfers, Minecraft, and Moto X3M at RatGames ‚Äî the meme-powered site with spinning rats, no downloads, and full browser support." />
    <meta name="keywords" content="unblocked games, free games online, browser games, school games, HTML5 games, play games at school, meme games, no download games, fun web games, RatGames, funny games, safe games for school, rat website, coolmath alternative, game site with rats" />
    <link rel="canonical" href="https://cty3ctyc42yjmxt3499ctn924u9xaje5y.vercel.app/" />
    <meta property="og:title" content="üêÄüéÆ RatGames ‚Äì Meme-Powered Unblocked Games" />
    <meta property="og:description" content="Play unblocked browser games with spinning rats. Featuring Subway Surfers, Minecraft, Moto X3M and more!" />
    <meta property="og:image" content="https://cty3ctyc42yjmxt3499ctn924u9xaje5y.vercel.app/media/rat-spinning.gif" />
    <meta property="og:url" content="https://cty3ctyc42yjmxt3499ctn924u9xaje5y.vercel.app/" />
    <meta name="twitter:card" content="summary_large_image" />

    <style>
        html,
        body {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
            background: #121212 url('https://cty3ctyc42yjmxt3499ctn924u9xaje5y.vercel.app/media/rat-spinning.gif') no-repeat center -100px fixed;
            background-size: contain;
            font-family: 'Comic Sans MS', sans-serif;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        h1 {
            font-size: 5em;
            margin: 0;
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.8);
        }

        #dailyText {
            font-size: 2em;
            margin: 0;
            font-weight: bold;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.8);
        }

        .button-container {
            margin-top: 30px;
        }

        .btn {
            background-color: #333;
            color: white;
            font-size: 20px;
            padding: 15px 30px;
            margin: 10px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .btn:hover {
            background-color: #555;
        }

        @media (max-width: 600px) {
            .btn {
                width: 80%;
            }
        }

        #corner-ads {
            position: fixed;
            bottom: 10px;
            left: 10px;
            z-index: 1000;
            font-size: 12px;
            color: white;
        }

        /* Tracker box styles */
        #tracker-box {
            background: #6b4c1a;
            color: white;
            padding: 0.75rem 1.5rem 1rem 1.5rem; /* reduced top padding to move text higher */
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0,0,0,0.3);
            text-align: center;
            width: 120px;
            height: 50px;
            font-size: 0.8rem;  /* reduced font size */
            line-height: 1.2;
            display: flex;
            flex-direction: column;
            justify-content: flex-start; /* moves text closer to top */
            align-items: center;
            overflow: hidden;
            font-family: Arial, sans-serif;
            user-select: none;
        }
    </style>
</head>
<body>
    <h1>Rat Games</h1>
    <h2 id="dailyText"></h2>

    <div class="button-container">
        <button class="btn" onclick="window.location.href='/files/games.html'">Games</button>
        <button class="btn" onclick="window.location.href='/files/tools.html'">Tools/Apps</button>
        <button class="btn" onclick="window.location.href='/files/survey.html'">Request Game/Feedback</button>
        <button class="btn" onclick="window.location.href='/files/terms.html'">Terms Of Use</button>
    </div>

    <script>
        const texts = [
            "By the students, for the students",
            "I always come back",
            "Make sure to share this with your friends",
            "If we don't have a game, request it",
            "I have to walk my fish hold up",
        ];

        function getCurrentIndex() {
            const lastUpdate = localStorage.getItem("lastUpdateTime");
            const storedIndex = localStorage.getItem("textIndex");
            const now = new Date().getTime();

            if (!lastUpdate || now - lastUpdate >= 5000 || storedIndex === null) {
                const newIndex = storedIndex === null ? 0 : (parseInt(storedIndex) + 1) % texts.length;
                localStorage.setItem("lastUpdateTime", now);
                localStorage.setItem("textIndex", newIndex);
                return newIndex;
            }
            return parseInt(storedIndex);
        }

        function updateText() {
            document.getElementById("dailyText").innerText = texts[getCurrentIndex()];
        }

        updateText();
        setInterval(updateText, 5000);

        if ("serviceWorker" in navigator) {
            window.addEventListener("load", () => {
                navigator.serviceWorker
                    .register("/install/service-worker.js")
                    .then((reg) => console.log("Service Worker registered:", reg.scope))
                    .catch((err) => console.error("Service Worker registration failed:", err));
            });
        }
    </script>

    <!-- Bottom-left tracker -->
    <div id="corner-ads">
      <div id="tracker-box">Loading...</div>
    </div>

    <script type="module">
      import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

      const box = document.getElementById("tracker-box");

      const SUPABASE_URL = "https://jfscpvfooviahjoqffkz.supabase.co";
      const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Impmc2NwdmZvb3ZpYWhqb3FmZmt6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIyNDk0ODYsImV4cCI6MjA2NzgyNTQ4Nn0.1RAefMzJRpOEGREICvGdRq9fHfKrC1sUnoagGgf9uwc";

      const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

      async function getIP() {
        try {
          const res = await fetch("https://api.ipify.org?format=json");
          const json = await res.json();
          return json.ip;
        } catch (e) {
          box.textContent = "‚ùå Failed to get IP:\n" + e.message;
          return null;
        }
      }

      async function getLocation(ip) {
        try {
          const res = await fetch(`https://ipwhois.app/json/${ip}`);
          const json = await res.json();
          if (json.success) {
            return [json.city, json.region, json.country].filter(Boolean).join(", ");
          }
        } catch (e) {
          box.textContent = "‚ùå Failed to get location:\n" + e.message;
        }
        return "Unknown location";
      }

      function getMDTStartOfTodayUTC() {
        const now = new Date();
        const parts = new Intl.DateTimeFormat('en-US', {
          timeZone: 'America/Denver',
          year: 'numeric',
          month: '2-digit',
          day: '2-digit',
        }).formatToParts(now);

        let year, month, day;
        for (const part of parts) {
          if (part.type === "year") year = part.value;
          else if (part.type === "month") month = part.value;
          else if (part.type === "day") day = part.value;
        }

        const isoString = `${year}-${month}-${day}T00:00:00-06:00`;
        const date = new Date(isoString);
        return date.toISOString();
      }

      async function insertVisit(ip, location) {
        const now = new Date().toISOString();
        const { error } = await supabase
          .from("visits")
          .insert([{ ip, location, visited_at: now }]);
        if (error) {
          box.textContent = "‚ùå Insert error:\n" + error.message;
          throw error;
        }
      }

      async function getTotalVisits() {
        const { count, error } = await supabase
          .from("visits")
          .select("*", { count: "exact", head: true });
        if (error) {
          box.textContent = "‚ùå Total count error:\n" + error.message;
          throw error;
        }
        return count || 0;
      }

      async function getTodaysVisits() {
        const mdtMidnightUTC = getMDTStartOfTodayUTC();
        const { count, error } = await supabase
          .from("visits")
          .select("*", { count: "exact", head: true })
          .gte("visited_at", mdtMidnightUTC);
        if (error) {
          box.textContent = "‚ùå Today count error:\n" + error.message;
          throw error;
        }
        return count || 0;
      }

      async function main() {
        try {
          box.textContent = "Loading...";
          const ip = await getIP();
          if (!ip) {
            box.textContent = "‚ùå Could not retrieve IP.";
            return;
          }

          const location = await getLocation(ip);

          await insertVisit(ip, location);

          const [totalVisits, todaysVisits] = await Promise.all([
            getTotalVisits(),
            getTodaysVisits()
          ]);

          box.innerHTML = `
            <div style="display:flex; align-items:center; gap:0.5rem; font-weight:bold; font-size:1.2rem; color:#d2b48c;">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="24" height="24">
                <path d="M13 22H4a2 2 0 0 1 0-4h12"></path>
                <path d="M13.236 18a3 3 0 0 0-2.2-5"></path>
                <path d="M16 9h.01"></path>
                <path d="M16.82 3.94a3 3 0 1 1 3.237 4.868l1.815 2.587a1.5 1.5 0 0 1-1.5 2.1l-2.872-.453a3 3 0 0 0-3.5 3"></path>
                <path d="M17 4.988a3 3 0 1 0-5.2 2.052A7 7 0 0 0 4 14.015 4 4 0 0 0 8 18"></path>
              </svg>
              <span>Visitors</span>
            </div>
            <div>Total Visits: ${totalVisits}</div>
            <div>Visits Today: ${todaysVisits}</div>
          `;
        } catch (e) {
          box.textContent = "‚ùå Unexpected error:\n" + e.message;
        }
      }

      main();
    </script>
</body>
</html>
