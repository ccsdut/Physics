<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>New Tab</title>
  <link rel="manifest" href="/install/manifest.json" />
  <style>
    html, body {
      margin: 0; padding: 0;
      height: 100%; width: 100%;
      overflow: hidden;
      background: black;
      font-family: sans-serif;
    }
    iframe {
      position: fixed;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      border: none;
      background: black;
    }
    /* Floating Menu Button (image only) */
    #menu-btn {
      position: fixed;
      top: 12px;
      left: 12px;
      z-index: 10000;
      background: none;
      border: none;
      padding: 0;
      cursor: pointer;
      transition: opacity 0.4s ease;  /* fade animation */
    }
    #menu-btn img {
      width: 60px;
      height: 60px;
    }

    /* Overlay background */
    #overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
      z-index: 9998;
      display: none;
      transition: opacity 0.4s ease;  /* fade animation */
    }

    /* Menu Box */
    #menu-box {
      position: fixed;
      top: 80px;
      left: 12px;
      background: rgba(0,0,0,0.9);
      border-radius: 16px;
      padding: 12px;
      display: none;
      flex-direction: column;
      gap: 12px;
      width: 200px;
      z-index: 9999;
      border: 2px solid white;
      transition: opacity 0.4s ease;  /* fade animation */
    }
    .menu-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px;
      background: rgba(255,255,255,0.1);
      border-radius: 10px;
      cursor: pointer;
      color: white;
      font-size: 14px;  /* smaller so "Remove Menu Button" fits one line */
      font-weight: bold;
      white-space: nowrap; /* force one line */
    }
    .menu-item:hover {
      background: rgba(255,255,255,0.2);
    }
    .menu-item img {
      width: 26px;
      height: 26px;
    }
  </style>
</head>
<body>

  <!-- Menu Button -->
  <button id="menu-btn"><img src="https://ratgames.vercel.app/media/menu.png" alt="Menu"></button>

  <!-- Overlay -->
  <div id="overlay"></div>

  <!-- Menu Box -->
  <div id="menu-box">
    <!-- Remove Menu Button -->
    <div class="menu-item" onclick="removeMenu()">
      <img src="https://ratgames.vercel.app/media/no-menu.png" alt="Remove Menu"> Remove Menu Button
    </div>
    <div class="menu-item" onclick="goHome()">
      <img src="https://cty3ctyc42yjmxt3499ctn924u9xaje5y.vercel.app/media/homeicon.png" alt="Home"> Home
    </div>
    <div class="menu-item" onclick="toggleFullscreen()">
      <img src="https://cty3ctyc42yjmxt3499ctn924u9xaje5y.vercel.app/media/fullscreen.png" alt="Fullscreen"> Fullscreen
    </div>
    <div class="menu-item" id="installBtn" style="display:none;">
      <img src="https://cty3ctyc42yjmxt3499ctn924u9xaje5y.vercel.app/media/install.png" alt="Install"> Install
    </div>
  </div>

  <!-- Game Iframe -->
  <iframe id="game-iframe" src="https://ratgames.vercel.app/files/home.html" allow="fullscreen; autoplay; encrypted-media; pointer-lock"></iframe>

  <script>
    const menuBtn = document.getElementById('menu-btn');
    const menuBox = document.getElementById('menu-box');
    const overlay = document.getElementById('overlay');
    const iframe = document.getElementById('game-iframe');

    // Toggle menu
    menuBtn.onclick = () => {
      const open = menuBox.style.display === "flex";
      if (open) {
        menuBox.style.opacity = 0;
        overlay.style.opacity = 0;
        setTimeout(() => {
          menuBox.style.display = "none";
          overlay.style.display = "none";
        }, 400);
      } else {
        menuBox.style.display = "flex";
        overlay.style.display = "block";
        setTimeout(() => {
          menuBox.style.opacity = 1;
          overlay.style.opacity = 1;
        }, 10);
      }
    };
    overlay.onclick = () => {
      closeMenu();
    };

    function closeMenu() {
      menuBox.style.opacity = 0;
      overlay.style.opacity = 0;
      setTimeout(() => {
        menuBox.style.display = "none";
        overlay.style.display = "none";
      }, 400);
    }

    // Menu actions
    function goHome() {
      iframe.src = "https://ratgames.vercel.app/files/home.html";
      closeMenu();
    }
    function toggleFullscreen() {
      if (!document.fullscreenElement) {
        iframe.requestFullscreen?.() || iframe.webkitRequestFullscreen?.() || iframe.msRequestFullscreen?.();
      } else {
        document.exitFullscreen?.() || document.webkitExitFullscreen?.() || document.msExitFullscreen?.();
      }
      closeMenu();
    }

    function removeMenu() {
      // fade out all menu elements
      menuBtn.style.opacity = 0;
      menuBox.style.opacity = 0;
      overlay.style.opacity = 0;
      setTimeout(() => {
        menuBtn.remove();
        menuBox.remove();
        overlay.remove();
      }, 400); // match transition duration
    }

    // PWA Install
    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      document.getElementById('installBtn').style.display = 'flex';
    });

    document.getElementById('installBtn').onclick = () => {
      deferredPrompt.prompt();
      deferredPrompt.userChoice.finally(() => {
        deferredPrompt = null;
        document.getElementById('installBtn').style.display = 'none';
      });
    };
  </script>
</body>
</html>
